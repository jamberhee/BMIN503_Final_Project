---
title: "Your Title"
subtitle: "BMIN503/EPID600 Final Project"
author: "Amber Rhee"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers. Feel free to change the theme and other display settings, although this is not required. I added a new sentence

## Overview {#sec-overview}

Give a brief a description of your project and its goal(s), what data you are using to complete it, and what two faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

For my final project, I am using data from the 2023 NHIS's (Sample Adult) communication core and chronic pain content to examine the association between one's communication ability (which can, e.g., translate into ability to communicate symptoms to providers) and high impact pain (pain defined as significant enough to limit daily activities). John Farrar, MD, PhD has helped me consider potential confounders and effect modifiers that may affect the association between my variables of interest, while Adam Naj, PhD has helped me decide how I want to model the actual data in my analyis.

[Final Project Repo](https://github.com/jamberhee/BMIN503_Final_Project)

## Introduction {#sec-introduction}

Describe the problem addressed, its significance, and some background to motivate the problem. This should extend what is in the @sec-overview.

Chronic pain is a major public health concern in the U.S., with high prevalence across sociodemographic groups \[1\]. The incidence of chronic pain cases is reported greater than the incidence of diabetes, depression, and hypertension \[2\] And disparities in pain management are significant \[3\].

The official definition of pain acknowledges pain as a subjective experience, where an individual's report of pain is to be respected \[4\]. It also notes, "inability to communicate does not negate the possibility that a human […] experiences pain" \[4\].

Communication requires both a patient to properly express their symptoms and a healthcare provider to listen and understand. Verbal communication is considered the "gold standard" for pain assessment \[5\]. A review found that a major reason for provider dismissal and downgrading of patient credibility regarding their pain was due to ineffective pain communication by the patient \[5\]. Additional qualitative research has found healthcare providers view pain assessment in individuals with communication difficulties to be challenging and time-consuming \[6\]. And yet, disparities in pain in relation to communication difficulties are not well documented or quantified.

References

1.  Rikard SM, Strahan AE, Schmit KM, Guy GP Jr.. Chronic Pain Among Adults — United States, 2019–2021. MMWR Morb Mortal Wkly Rep 2023;72:379–385. DOI: http://dx.doi.org/10.15585/mmwr.mm7215a1
2. Nahin RL, Feinberg T, Kapos FP, Terman GW. Estimated Rates of Incident and Persistent Chronic Pain Among US Adults, 2019-2020. JAMA Netw Open. 2023 May 1;6(5):e2313563. doi: 10.1001/jamanetworkopen.2023.13563. PMID: 37191961; PMCID: PMC10189566.
3.  Nguyen LH, Dawson JE, Brooks M, Khan JS, Telusca N. Disparities in Pain Management. Anesthesiol Clin. 2023 Jun;41(2):471-488. doi: 10.1016/j.anclin.2023.03.008. PMID: 37245951.
4. Raja SN, Carr DB, Cohen M, Finnerup NB, Flor H, Gibson S, Keefe FJ, Mogil JS, Ringkamp M, Sluka KA, Song XJ, Stevens B, Sullivan MD, Tutelman PR, Ushida T, Vader K. The revised International Association for the Study of Pain definition of pain: concepts, challenges, and compromises. Pain. 2020 Sep 1;161(9):1976-1982. doi: 10.1097/j.pain.0000000000001939. PMID: 32694387; PMCID: PMC7680716.
5.  Sabater-Gárriz Á, Molina-Mula J, Montoya P, Riquelme I. Pain assessment tools in adults with communication disorders: systematic review and meta-analysis. BMC Neurol. 2024 Feb 17;24(1):66. doi: 10.1186/s12883-024-03539-w. PMID: 38368314; PMCID: PMC10873938.
6. Tosas MR. The downgrading of pain sufferers' credibility. Philos Ethics Humanit Med. 2021 Oct 6;16(1):8. doi: 10.1186/s13010-021-00105-x. PMID: 34610826; PMCID: PMC8493671.


Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Because pain is defined by a biopsychosocial model, meaning physiological, psychological, and social factors all play an integral role, interacting with each other to create pain outcomes \[6\], attempting to study pain at the population level is, thus, an intricate task. I could benefit to receive inputs from general practitioners, pain specialists, psychologists, and even behavioral and social scientists to gain insights on my research question but also from epidemiologists to learn to how I can explore this question in a nationally-representative survey and what considerations I have to make in the process. Dr. John Farrar, as both a clinical epidemiologist and neurologist, _(will continue to add as I meet him again)___________. Dr. Adam Naj, _(will continue to add as I meet him again)___________.

References

6.  Meints SM, Edwards RR. Evaluating psychosocial contributions to chronic pain outcomes. Prog Neuropsychopharmacol Biol Psychiatry. 2018 Dec 20;87(Pt B):168-182. doi: 10.1016/j.pnpbp.2018.01.017. Epub 2018 Jan 31. PMID: 29408484; PMCID: PMC6067990.

## Methods {#sec-methods}

Describe the data used and general methodological approach used to address the problem described in the @sec-introduction. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why.

I used "Sample Adult" data from the 2023 National Health Interview Survey (NHIS). Estimates from the NHIS are designed to be representative of the noninstitutionalized civilian population of the U.S.

> Install and load libraries

```{r}
# install.packages("tidyverse)
# install.packages("survey")

library(tidyverse)
library(survey)
library(table1)
library(corrplot)
```

> Load data

```{r}
## loaded according to recommended/provided code from NHIS
### prevents errors in reading in data file due to missingness in data
adult2023 <- read_csv("adult23.csv", guess_max = 29522)

## https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2023/adult23csv.zip

```

Communication difficulty was determined by the question, "Using your usual language, do you have difficulty communicating, for example, understanding or being understood?" Participants could respond, "No difficulty", "Some difficulty", "A lot of difficulty", or "Cannot do at all." Due to small sample size, I collapsed the "A lot of difficulty" and "Cannot do at all" participants into a single group.

Participants were asked, "In the past three months, how often did you have pain?", to which they could answer, "Never," "Some days," "Most days," or "Every day." Only those who reported any pain to this question were asked the follow question: "Over the past three months, how often did your pain limit your life or work?" High impact pain was defined as pain that limited life or work "Most days" or "Every day." Participants who responded "Never" or "Some days" or reported no pain in the last three months were classified as individuals without high impact pain.

> Initial inspection of data for sample size

```{r}
## check unique adults in dataset
### 29522 adults--one row per participant
length(unique(adult2023$HHX))

## change missing to NA
## convert comm difficulty variable to factor
## collapse lots + completely due to small cell size
adult2023 <- adult2023 %>% 
  mutate(COMDIFF_A = as.factor(case_when(adult2023$COMDIFF_A > 4 ~ NA,
                               adult2023$COMDIFF_A == 4 |
                                 adult2023$COMDIFF_A == 3 ~ "Lots or Completely",
                               adult2023$COMDIFF_A == 2 ~ "Some",
                               adult2023$COMDIFF_A == 1 ~ "None")))
adult2023$COMDIFF_A <- factor(adult2023$COMDIFF_A, 
                              levels = c("None","Some","Lots or Completely"))
table(adult2023$COMDIFF_A,useNA = "always")

## change missing to NA
## convert high impact pain variable to factor
adult2023$PAIWKLM3M_A <- ifelse(adult2023$PAIWKLM3M_A > 4, NA, adult2023$PAIWKLM3M_A)
adult2023$PAIWKLM3M_A <- factor(adult2023$PAIWKLM3M_A,
                                labels = c("Never","Some","Most","Every"))
table(adult2023$PAIWKLM3M_A)

## create pain binary variable for outcome
adult2023 <- adult2023 |>
  mutate(hip_binary = ifelse(adult2023$PAIWKLM3M_A == "Never" |
                               adult2023$PAIWKLM3M_A == "Some", 0, 1))

## examine outcome for sample size
table(adult2023$hip_binary)
prop.table(table(adult2023$COMDIFF_A,adult2023$hip_binary),2)
```

> Examine sampling

```{r}
## rename variables of interest
## 7 participants missing exposure
## cannot filter out individuals because
### all of the strata need to be used in the calculation of the standard error
data <- adult2023 %>% 
  as.data.frame() %>% 
  rename(id = HHX,
         strata = PSTRAT,
         sweight = WTFA_A,
         psu = PPSU,
         comdiff = COMDIFF_A,
         pain = PAIFRQ3M_A,
         hip = PAIWKLM3M_A)

## if no pain, no hip also
data <- data %>% 
  mutate(hip = ifelse(pain == 1, 1, hip)) %>%
  mutate(hip_binary = ifelse(pain == 1, 0, hip_binary))
weighted_data_test <-svydesign(id=~psu, weights=~sweight,
                          strata=~strata, nest=TRUE,
                          data = data)

summary(weighted_data_test)

svytable(~comdiff+hip, weighted_data_test)
svytable(~comdiff+hip_binary, weighted_data_test)
```

Confounders and effect modifiers were identified a priori from the literature and discussed with Dr. Farrar. My hypothetical causal framework is depicted in a directed acyclic graph (DAG) below. Of my proposed confounders, 2 were not captured in the data--autism and stress. They cannot, thus, be controlled for the in the analysis. I used "use of a hearing aid" as a proxy for hearing loss. All conditions (stroke, dementia, fatigue, anxiety) are ever-diagnoses.

> Identify confounders

```{r}
knitr::include_graphics("dag_1122.png")
```

Due to a high level of missingness (~30%), I decided to stratify by primary language in a subanalysis instead of the entire analytic population.

> Finalize dataset before weighting

```{r}
## rename variables of interest (confounders, effect modifiers)
## isolate variables i want to work with
## 932 (3% of total sample) missing outcome
data <- data %>% 
  rename(lang_other = LANGHM_A,
         lang_tv = LANGMED_A,
         lang_doc = LANGDOC_A,
         lang_soc = LANGSOC_A,
         race = HISPALLP_A,
         age = AGEP_A,
         hearing = HEARAID_A,
         dementia = DEMENEV_A,
         fatigue = CFSEV_A,
         anxiety = ANXEV_A,
         sex = SEX_A,
         stroke = STREV_A) %>% 
  select(id,strata,sweight,psu,comdiff,pain,hip,hip_binary,
         lang_other,lang_tv,lang_doc,lang_soc,race,age,
         hearing,dementia,fatigue,anxiety,sex,stroke)

summary(data)

## make na values na
cols <- c(6,9:12,15:20)
data <- data %>% 
  mutate(across(all_of(cols), ~ if_else(.x >= 7, NA_real_, .x))) %>% 
  mutate(age = ifelse(age > 85, NA, age))

## check for correlation between conditions
vars <- data[, c(15:18,20)]
vars01 <- as.tibble(ifelse(vars == 2, 1, 0))
cor_mat <- cor(vars01,use = "pairwise.complete.obs")
corrplot(cor_mat, method = "color",
         type = "upper", tl.col = "black", tl.cex = 0.7)

## convert pain var to factors
data[,6:7] <- lapply(data[,6:7], factor,
                       levels = c(1:4),
                       labels = c("Never", "Some", "Most", "Every"))

## identify those reporting any other language as primary
data <- data %>% 
  mutate(across(lang_tv:lang_soc, ~ as.factor(case_when(.x == 1 ~ "English",
                                              is.na(.x) ~ "Missing",
                                              .x == 2 ~ "Other language"))),
         otherlang_any = as.factor(case_when(if_any(lang_tv:lang_soc, ~ .x == "Other language") ~ "Yes",
                                   if_any(lang_tv:lang_soc, ~ .x == "English") ~ "No",
                                   TRUE ~ NA)),
         across(lang_tv:lang_soc, ~ ifelse(.x == "Missing", NA, .x)))

## convert language vars to factors
data[,10:12] <- lapply(data[,10:12], factor,
                       levels = c(1,3),
                       labels = c("English", "Other language"))

## convert y/n vars to factors
data[,c(9,15:18,20)] <- lapply(data[,c(9,15:18,20)], factor,
                       levels = c(1,2),
                       labels = c("Yes", "No"))

data[,c(9,15:18,20)] <- lapply(data[,c(9,15:18,20)], relevel,
                            ref = "No")

## convert remaining vars to factors                    
data <- data %>% 
  mutate(id = factor(id),
         hip_binary = factor(hip_binary,
                             levels = c(0,1),
                             labels = c("No","Yes")),
         race = factor(race,
                       levels = c(1:7),
                       labels = c("Hispanic","NH White","NH Black",
                                  "NH Asian", "NH AIAN only", "NH AIAN and other",
                                  "Other/Multi")),
         sex = factor(sex,
                      levels = c(1,2),
                      labels = c("Male","Female")))

## create variable for whether otherlang matches with lang_doc
data <- data %>% 
  mutate(lang_match = as.factor(case_when(lang_doc == "English" & otherlang_any == "No" ~ "Match",
                                          lang_doc == "Other language" & otherlang_any == "Yes" ~ "Match",
                                          lang_doc == "English" & otherlang_any == "Yes" ~ "No match",
                                          lang_doc == "Other language" & otherlang_any == "No" ~ "No match",
                                          TRUE ~ NA)))

summary(data)

# save(data, file = "data.Rda")
load("data.Rda")
```

For all covariate variables, missing values were imputed using multiple imputation by chained equations (MICE).

> MICE

```{r}
## remove test to clear up environment
rm(weighted_data_test)

## prepare for multiple imputation followed by deletion of imputed outcomes
data_main <- data %>%
  select(-c(6:7,9:12,21))

## check missingness pattern
md.pattern(data_main)

## remove lang from imputation
init = mice(data_main, maxit = 0)
meth = init$method

meth[c("lang_match")] = ""


## run imputation, 5 iterations
imp <- mice(data_main, method=meth, maxit = 5, seed = 1234)

## imputation = very computationally intensive so comment out
# save(imp, file="imp.Rda")
load("imp.Rda")

# check for convergence
plot(imp)
summary(imp)
```

Participants missing the exposure, outcome, or both variables were excluded from the calculation of the estimates. They remain included for the calculation of the standard errors. Imputed datasets were weighted using the R package survey 4.4-8 according to the weights provided by the NHIS dataset. 

> Apply weighting+subsetting

```{r}
impdata <- mice::complete(imp, action = "all")

data.list <- vector("list", 5)
# subset the data without Y and A's that had missing values
# and record those subset data
for (i in 1:5) {
  analytic.i <- impdata[[i]]
  analytic.i$miss <- 1
  analytic.i$miss[analytic.i$id %in%
                    subset(data,complete.cases(comdiff,hip_binary))$id] <- 0
  data.list[[i]] <- analytic.i
}
data.list 


require(survey)
fit.list1 <- vector("list", 5)
fit.list2 <- vector("list", 5)
fit.list3 <- vector("list", 5)
for (i in 1:5) {
  analytic.i <- data.list[[i]]
  # assigning survey features = 1
  weighted_data <- svydesign(id=~psu, weights=~sweight,
                          strata=~strata, nest=TRUE,
                          data = analytic.i)
  weighted_complete <- subset(weighted_data, miss == 0)
  fit1 <- svyglm(hip_binary~comdiff,
                  family=quasibinomial,
                  design=weighted_complete, na.action = na.omit)
  fit.list1[[i]] <-  fit1
  fit2 <- svyglm(hip_binary~comdiff+sex+race+age,
                  family=quasibinomial,
                  design=weighted_complete, na.action = na.omit)
  fit.list2[[i]] <-  fit2
  fit3 <- svyglm(hip_binary~comdiff+sex+race+age+hearing+dementia+fatigue+anxiety+stroke,
                  family=quasibinomial,
                  design=weighted_complete, na.action = na.omit)
  fit.list3[[i]] <-  fit3
}


require(mitools)
fit.list <- list(fit.list1,fit.list2,fit.list3)
pooled.estimates <- lapply(fit.list,MIcombine)
pooled.estimates

lapply(pooled.estimates, summary, logeffect=T)

exp(summary(fit.list3[[1]])$coef)
summary(pooled.estimates[[3]], logeffect=T) %>% View()
## apply weights

## subset data to only include participants with exposure and outcome data

## representative of 258237552 individuals to 249862610 individuals weighted
sum(weights(weighted_data))
sum(weights(weighted_complete))

## total number of individuals examined
length(unique(subset(data,complete.cases(comdiff,hip_binary))$id))

```


I conducted a logistic regression of communication difficulty on high impact pain, adjusted for sex, race/ethnicity, age (continuous), hearing loss, dementia, fatigue, anxiety, and stroke. All confounders were included as factors, unless otherwise specified.


As a subanalysis,

Try without MICE
```{r}
weighted_data <- svydesign(id=~psu, weights=~sweight,
                          strata=~strata, nest=TRUE,
                          data = data)
sum(weights(weighted_data))
weighted_sub <- subset(weighted_data, complete.cases(comdiff,hip_binary,sex,
                                                     race,age,hearing,dementia,
                                                     fatigue,anxiety,stroke))

sum(weights(weighted_sub))

  fit1_sub <- svyglm(hip_binary~comdiff,
                  family=quasibinomial,
                  design=weighted_sub, na.action = na.omit)
  fit2_sub <- svyglm(hip_binary~comdiff+sex+race+age,
                  family=quasibinomial,
                  design=weighted_sub, na.action = na.omit)
  fit3_sub <- svyglm(hip_binary~comdiff+sex+race+age+hearing+dementia+fatigue+anxiety+stroke,
                  family=quasibinomial,
                  design=weighted_sub, na.action = na.omit)

summary(fit1_sub,logeffect=T)
summary(fit2_sub,logeffect=T)
exp(summary(fit3_sub)$coef)
results <- rownames_to_column(as.data.frame(summary(fit3_sub)$coef), var = "var") %>% 
  mutate(or = exp(Estimate),
         lower.CI = exp(Estimate - 1.96*`Std. Error`),
         upper.CI = exp(Estimate + 1.96*`Std. Error`))

results_null <- rownames_to_column(as.data.frame(summary(fit1_sub)$coef), var = "var") %>% 
  mutate(or = exp(Estimate),
         lower.CI = exp(Estimate - 1.96*`Std. Error`),
         upper.CI = exp(Estimate + 1.96*`Std. Error`))

## check
svymean(~age,weighted_sub)
svyby(~age,~I(complete.cases(comdiff,hip_binary,sex,
                                                     race,age,hearing,dementia,
                                                     fatigue,anxiety,stroke)),weighted_data,svymean)


weighted_sub2 <- subset(weighted_data, complete.cases(comdiff,hip_binary,sex,
                                                     race,age,hearing,dementia,
                                                     fatigue,anxiety,stroke,lang_match))
sum(weights(weighted_sub2))
dim(subset(data, complete.cases(comdiff,hip_binary,sex,
                                race,age,hearing,dementia,
                                fatigue,anxiety,stroke,lang_match)))

weighted_sub_match <- subset(weighted_sub2, lang_match == "Match")
weighted_sub_nomatch <- subset(weighted_sub2, lang_match == "No match")

sum(weights(weighted_sub_match))
sum(weights(weighted_sub_nomatch))
dim(subset(subset(data, complete.cases(comdiff,hip_binary,sex,
                                race,age,hearing,dementia,
                                fatigue,anxiety,stroke,lang_match)),lang_match == "Match"))
dim(subset(subset(data, complete.cases(comdiff,hip_binary,sex,
                                race,age,hearing,dementia,
                                fatigue,anxiety,stroke,lang_match)),lang_match == "No match"))

## check
svymean(~age,weighted_sub_match)
svyby(~age,~I(lang_match == "Match"),weighted_sub2,svymean)
svymean(~age,weighted_sub_nomatch)
svyby(~age,~I(lang_match == "No match"),weighted_sub2,svymean)

fit3_sub_match <- svyglm(hip_binary~comdiff+sex+race+age+hearing+dementia+fatigue+anxiety+stroke,
                         family=quasibinomial,
                         design=weighted_sub_match, na.action = na.omit)
fit3_sub_nomatch <- svyglm(hip_binary~comdiff+sex+race+age+hearing+dementia+fatigue+anxiety+stroke,
                         family=quasibinomial,
                         design=weighted_sub_nomatch, na.action = na.omit)

summary(fit3_sub_match)
summary(fit3_sub_nomatch)

results_match <- as_tibble(summary(fit3_sub_match)$coef) %>% 
  mutate(or = exp(Estimate),
         lower.CI = exp(Estimate - 1.96*`Std. Error`),
         upper.CI = exp(Estimate + 1.96*`Std. Error`))
results_nomatch <- as_tibble(summary(fit3_sub_nomatch)$coef) %>% 
  mutate(or = exp(Estimate),
         lower.CI = exp(Estimate - 1.96*`Std. Error`),
         upper.CI = exp(Estimate + 1.96*`Std. Error`))

prop.table(svytable(~comdiff, weighted_sub))

```



## Results {#sec-results}

Describe your results and include relevant tables, plots, and code/comments used to obtain them. You may refer to the @sec-methods as needed. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

# Study Population

Table 1 shows selected characteristics of the U.S. adults examined in our analysis.

```{r}
table1_data <- subset(data, complete.cases(comdiff,hip_binary,sex,
                                race,age,hearing,dementia,
                                fatigue,anxiety,stroke))
dim(subset(data, complete.cases(comdiff,hip_binary)))
labels <- list(
    variables=list(sex="Sex",
                   age="Age (years)",
                   dementia="Dementia",
                   fatigue="Fatigue",
                   anxiety = "Anxiety",
                   stroke = "Stroke",
                   hearing = "Hearing",
                   race = "Race and Ethnicity"),
    groups=list("", "Communication Difficulty"))
strata <- c(list(Total=table1_data), split(table1_data, table1_data$comdiff))
table1 <- table1(strata,labels,groupspan=c(1,3),
                 data=table1_data,overall=c(left="Total"))
table1 ## need to clean up + label. weighted vs numbers?

sum(weights(weighted_data))
```

```{r}
## main analysis output
summary(logit3)

results <- as.data.frame(coef(summary(logit3))[2:3,],keep.rownames = "outcome")
results
```

## Conclusion

This the conclusion. The @sec-results can be invoked here.
