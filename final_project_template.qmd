---
title: "Your Title"
subtitle: "BMIN503/EPID600 Final Project"
author: "Amber Rhee"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers. Feel free to change the theme and other display settings, although this is not required. I added a new sentence

## Overview {#sec-overview}

Give a brief a description of your project and its goal(s), what data you are using to complete it, and what two faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

For my final project, I am using data from the 2023 NHIS's (Sample Adult) communication core and chronic pain content to examine the association between one's communication ability (which can, e.g., translate into ability to communicate symptoms to providers) and high impact pain (pain defined as significant enough to limit daily activities). John Farrar, MD, PhD has helped me consider potential confounders and effect modifiers that may affect the association between my variables of interest, while Adam Naj, PhD has helped me decide how I want to model the actual data in my analyis.

[Final Project Repo](https://github.com/jamberhee/BMIN503_Final_Project)

## Introduction {#sec-introduction}

Describe the problem addressed, its significance, and some background to motivate the problem. This should extend what is in the @sec-overview.

Chronic pain is a major public health concern in the U.S., with high prevalence across sociodemographic groups \[1\]. As a subjective experience, proper communication of pain and relevant symptoms from patient to healthcare provider and belief of patient-report by providers are essential for adequate management \[2-4\]. Consequently, disparities in pain management are significant \[5\].

References

  1. Rikard SM, Strahan AE, Schmit KM, Guy GP Jr.. Chronic Pain Among Adults — United States, 2019–2021. MMWR Morb Mortal Wkly Rep 2023;72:379–385. DOI: http://dx.doi.org/10.15585/mmwr.mm7215a1
  2. Sabater-Gárriz Á, Molina-Mula J, Montoya P, Riquelme I. Pain assessment tools in adults with communication disorders: systematic review and meta-analysis. BMC Neurol. 2024 Feb 17;24(1):66. doi: 10.1186/s12883-024-03539-w. PMID: 38368314; PMCID: PMC10873938.
  3. Brown VL, James A, Hunleth J, Bradley CS, Farrar JT, Gupta P, Lai HH, Lowder JL, Moldwin R, Rodriguez LV, Yang CC, Sutcliffe S. Believing women: a qualitative exploration of provider disbelief and pain dismissal among women with interstitial cystitis/bladder pain syndrome from the MAPP research network. Int Urogynecol J. 2024 Jan;35(1):139-148. doi: 10.1007/s00192-023-05677-0. Epub 2023 Nov 22. PMID: 37991567; PMCID: PMC11019919.
  4. Tosas, M.R. The downgrading of pain sufferers’ credibility. Philos Ethics Humanit Med 16, 8 (2021). https://doi.org/10.1186/s13010-021-00105-x
  5. Nguyen LH, Dawson JE, Brooks M, Khan JS, Telusca N. Disparities in Pain Management. Anesthesiol Clin. 2023 Jun;41(2):471-488. doi: 10.1016/j.anclin.2023.03.008. PMID: 37245951.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Pain is often defined by a biopsychosocial model, meaning physiological, psychological, and social factors all play an integral role, interacting with each other to create pain outcomes \[6\]. Attempting to study pain at the population level is, thus, an intricate task. I could benefit to receive inputs from general practitioners, pain specialists, psychologists, and even behavioral and social scientists to gain insights on my research question but also from epidemiologists to learn to how I can explore this question in a nationally-representative survey and what considerations I have to make in the process. Dr. John Farrar, as both a clinical epidemiologist and neurologist, (will continue to add as I meet him again). Dr. Adam Naj, (will continue to add as I meet him again). 

References

6. Meints SM, Edwards RR. Evaluating psychosocial contributions to chronic pain outcomes. Prog Neuropsychopharmacol Biol Psychiatry. 2018 Dec 20;87(Pt B):168-182. doi: 10.1016/j.pnpbp.2018.01.017. Epub 2018 Jan 31. PMID: 29408484; PMCID: PMC6067990.

## Methods {#sec-methods}

Describe the data used and general methodological approach used to address the problem described in the @sec-introduction. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why.


Install and load libraries

```{r}
# install.packages("tidyverse)
# install.packages("survey")

library(tidyverse)
library(survey)
library(dagitty)
library(table1)
```


Load data

```{r}
## loaded according to recommended/provided code from NHIS
### prevents errors in reading in data file due to missingness in data
adult2023 <- read_csv("adult23.csv", guess_max = 29522)

## https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2023/adult23csv.zip

```


Initial inspection of data
```{r}
## check unique adults in dataset
### 29522 adults--one row per participant
length(unique(adult2023$HHX))

## change missing to NA
## convert comm difficulty variable to factor
## collapse lots + completely due to small cell size
adult2023 <- adult2023 %>% 
  mutate(COMDIFF_A = as.factor(case_when(adult2023$COMDIFF_A > 4 ~ NA,
                               adult2023$COMDIFF_A == 4 |
                                 adult2023$COMDIFF_A == 3 ~ "Lots or Completely",
                               adult2023$COMDIFF_A == 2 ~ "Some",
                               adult2023$COMDIFF_A == 1 ~ "None")))
adult2023$COMDIFF_A <- factor(adult2023$COMDIFF_A, 
                              levels = c("None","Some","Lots or Completely"))
table(adult2023$COMDIFF_A,useNA = "always")

## change missing to NA
## convert high impact pain variable to factor
adult2023$PAIWKLM3M_A <- ifelse(adult2023$PAIWKLM3M_A > 4, NA, adult2023$PAIWKLM3M_A)
adult2023$PAIWKLM3M_A <- factor(adult2023$PAIWKLM3M_A,
                                labels = c("Never","Some","Most","Every"))
table(adult2023$PAIWKLM3M_A)

## create pain binary variable for outcome
adult2023 <- adult2023 |>
  mutate(hip_binary = ifelse(adult2023$PAIWKLM3M_A == "Never" |
                               adult2023$PAIWKLM3M_A == "Some", 0, 1))

## examine outcome for sample size
table(adult2023$hip_binary)
prop.table(table(adult2023$COMDIFF_A,adult2023$hip_binary),2)
```


Examine sampling
```{r}
## rename variables of interest
## 7 participants missing exposure
## cannot filter out individuals because
### all of the strata need to be used in the calculation of the standard error
data <- adult2023 %>% 
  as.data.frame() %>% 
  rename(id = HHX,
         strata = PSTRAT,
         sweight = WTFA_A,
         psu = PPSU,
         comdiff = COMDIFF_A,
         pain = PAIFRQ3M_A,
         hip = PAIWKLM3M_A)

## if no pain, no hip also
data <- data %>% 
  mutate(hip = ifelse(pain == 1, 1, hip)) %>%
  mutate(hip_binary = ifelse(pain == 1, 0, hip_binary))
weighted_data_test <-svydesign(id=~psu, weights=~sweight,
                          strata=~strata, nest=TRUE,
                          data = data)

summary(weighted_data_test)

svytable(~comdiff+hip, weighted_data_test)
svytable(~comdiff+hip_binary, weighted_data_test)
```


Finalize dataset before weighting
```{r}
## rename variables of interest (confounders, effect modifiers)
## isolate variables i want to work with
## 932 (3% of total sample) missing outcome
data <- data %>% 
  rename(lang_other = LANGHM_A,
         lang_tv = LANGMED_A,
         lang_doc = LANGDOC_A,
         lang_soc = LANGSOC_A,
         race = HISPALLP_A,
         age = AGEP_A,
         hearing = HEARAID_A,
         dementia = DEMENEV_A,
         fatigue = CFSEV_A,
         anxiety = ANXEV_A,
         sex = SEX_A) %>% 
  select(id,strata,sweight,psu,comdiff,pain,hip,hip_binary,
         lang_other,lang_tv,lang_doc,lang_soc,race,age,
         hearing,dementia,fatigue,anxiety,sex)

summary(data)

## make na values na
cols <- c(6,9:12,15:19)
data <- data %>% 
  mutate(across(all_of(cols), ~ if_else(.x >= 7, NA_real_, .x))) %>% 
  mutate(age = ifelse(age > 85, NA, age))

## convert pain var to factors
data[,6:7] <- lapply(data[,6:7], factor,
                       levels = c(1:4),
                       labels = c("Never", "Some", "Most", "Every"))

## convert language vars to factors
data[,10:12] <- lapply(data[,10:12], factor,
                       levels = c(1,2),
                       labels = c("English", "Other language"))

## convert y/n vars to factors
data[,c(9,15:18)] <- lapply(data[,c(9,15:18)], factor,
                       levels = c(1,2),
                       labels = c("Yes", "No"))

data[,c(9,15:18)] <- lapply(data[,c(9,15:18)], relevel,
                            ref = "No")

## convert remaining vars to factors                    
data <- data %>% 
  mutate(id = factor(id),
         hip_binary = factor(hip_binary,
                             levels = c(0,1),
                             labels = c("No","Yes")),
         race = factor(race,
                       levels = c(1:7),
                       labels = c("Hispanic","NH White","NH Black",
                                  "NH Asian", "NH AIAN only", "NH AIAN and other",
                                  "Other/Multi")),
         sex = factor(sex,
                      levels = c(1,2),
                      labels = c("Male","Female")))
         
prop.table(table(data$lang_other, useNA = "always")) ## fairly high level of missingness
## maybe do stratification as a sub-analysis

summary(data)

# save(data, file = "data.Rda")
load("data.Rda")
```


Apply weighting
```{r}
weighted_data <-svydesign(id=~psu, weights=~sweight,
                          strata=~strata, nest=TRUE,
                          data = data)

rm(weighted_data_test)
```


Inspection of weighted data
```{r}
svytable(~comdiff+hip_binary, weighted_data)

svyhist(~age, weighted_data, probability = FALSE)


```

Run analysis
```{r}
## base logistic regression
logit1 <- (svyglm(hip_binary~comdiff, family=quasibinomial,
                  design=weighted_data, na.action = na.omit))
summary(logit1)
```

## Results {#sec-results}

Describe your results and include relevant tables, plots, and code/comments used to obtain them. You may refer to the @sec-methods as needed. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

# Study Population
Table 1 shows selected characteristics of the U.S. adults examined in our analysis. 
```{r}
table1_data <- data
label(table1_data$sex) <- "Sex"
label(table1_data$hip_binary) <- "High Impact Pain"
label(table1_data$race) <- "Race and Ethnicity"
label(table1_data$age) <- "Age"
label(table1_data$comdiff) <- "Difficulty Communicating"
label(table1_data$dementia) <- "Dementia"
label(table1_data$hearing) <- "Hearing"
label(table1_data$fatigue) <- "Fatigue"
label(table1_data$anxiety) <- "Anxiety"
table1 <- table1(~ sex + age + race + comdiff + dementia +
                   hearing + fatigue + anxiety| hip_binary,
                 data=table1_data)
table1 ## need to clean up + label. weighted vs numbers?
```

~analysis still in progress~


## Conclusion

This the conclusion. The @sec-results can be invoked here.
